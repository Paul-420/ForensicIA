<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs Display</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 16px;
            text-align: left;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #333;
            color: white;
            cursor: pointer; /* Show it's sortable */
        }

        th:hover {
            background-color: #555;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2; /* Light gray for even rows */
        }

        tr:hover {
            background-color: #ddd; /* Highlight row on hover */
        }

        /* Highlight rows with attacks */
        tr[data-attack-type]:not([data-attack-type="No attacks"]) {
            background-color: #ffe6e6; /* Light red for attack rows */
        }

    </style>
</head>
<body>
<h1>Logs</h1>
<table id="logs-table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Method</th>
        <th>URL</th>
        <th>Query Parameters</th>
        <th>Headers</th>
        <th id="attackTypeHeader">Attack Type</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    // Function to fetch logs from the backend
    async function fetchLogs() {
        try {
            const response = await fetch('http://localhost:3000/api/logs');
            const logs = await response.json();

            const tableBody = document.querySelector('#logs-table tbody');

            logs.forEach(log => {
                const row = document.createElement('tr');

                row.setAttribute("data-attack-type", log.attack_type); // Set attack type as a data attribute

                row.innerHTML = `
            <td>${log.id}</td>
            <td>${log.method}</td>
            <td>${log.url}</td>
            <td>${log.query_parameters}</td>
            <td>${log.headers}</td>
            <td>${log.attack_type}</td>
          `;
                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching logs:', error);
        }
    }

    document.getElementById('attackTypeHeader').addEventListener('click', function() {
        const table = document.getElementById('logs-table');
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        const sortedRows = rows.sort((rowA, rowB) => {
            const attackTypeA = rowA.cells[5].innerText; // Assuming attack type is in the 6th column (index 5)
            const attackTypeB = rowB.cells[5].innerText;


            if (attackTypeA === "No attacks") return 1;  // Move "No attacks" to the bottom
            if (attackTypeB === "No attacks") return -1; // Move "No attacks" to the bottom

            return attackTypeA.localeCompare(attackTypeB);
        });

        // Clear the table and append the sorted rows
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';
        sortedRows.forEach(row => tbody.appendChild(row));
    });


    // Call the fetchLogs function when the page loads
    window.onload = fetchLogs;
</script>
</body>
</html>
